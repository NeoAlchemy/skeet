<html>
    <head>  
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
        <script>
            // Component to handle click and touch on the fakeButton
            AFRAME.registerComponent('button', {
              init: function () {
                const clayPigeon = document.getElementById('clayPigeon');
                let isIntersecting = false;

                // Detect if the mouse or touch is intersecting with the button
                this.el.addEventListener('raycaster-intersected', () => {
                    isIntersecting = true;
                });

                // Detect if the mouse or touch stops intersecting with the button
                this.el.addEventListener('raycaster-intersected-cleared', () => {
                    isIntersecting = false;
                });

                // Add click event listener to hide clayPigeon if intersecting
                this.el.addEventListener('click', function() {
                    console.log("test")
                    if (isIntersecting) {
                        console.log("Button clicked while intersecting.");
                        clayPigeon.setAttribute('visible', 'false');
                    }
                });

                // Add touchstart event listener to hide clayPigeon if intersecting
                this.el.addEventListener('touchstart', function() {
                    if (isIntersecting) {
                        clayPigeon.setAttribute('visible', 'false');
                    }
                }, { passive: true });
              }
            });

            // Component for detecting if shotgun raycaster hits the clayPigeon
            AFRAME.registerComponent('shotgun-raycaster', {
              init: function () {
                const clayPigeon = document.getElementById('clayPigeon');
                const raycasterEl = this.el;

                // Event listener to detect intersection with the clayPigeon
                raycasterEl.addEventListener('raycaster-intersection', function(event) {
                  const intersects = event.detail.intersections;

                  // Check if the clayPigeon is one of the intersected objects
                  if (intersects.length > 0 && intersects[0].object.el === clayPigeon) {
                    console.log('Shotgun hit the clay pigeon!');
                  }
                });
              }
            });

        </script>
    </head>
    <body>
        <a-scene>
            <a-assets>
                <a-asset-item id="shotgun" src="/assets/shotgun/shotgun.gltf"></a-asset-item>
                <a-asset-item id="clay-pigeon" src="/assets/clay-pigeon/scene.gltf"></a-asset-item>
            </a-assets>

            <!-- Clay pigeon target -->
            <a-entity id="clayPigeon" class="collidable" gltf-model="#clay-pigeon" position="0 1 -20" visible="true"></a-entity>

            <!-- Camera with look-controls -->
            <a-entity camera look-controls position="0 1.6 0">
                
                <!-- Shotgun with raycaster to detect clayPigeon 
                <a-entity 
                  gltf-model="#shotgun" 
                  shotgun-raycaster
                  raycaster="objects: .collidable; far: 100; showLine: true; interval: 500" 
                  rotation="-30 220 20" 
                  position="0.5 -0.6 -1">
                </a-entity> -->
                
                <!-- Fake button for shooting -->
                
                <a-entity id="fakeButton" button position="0 0 -2" class="clickable" visible="true"> <!-- position: 0 -1.3 -2 -->
                    <a-circle color="white" radius="0.3" position="0 0 0"></a-circle>
                    <a-text value="Shoot" color="black" align="center" position="0 0 0.01" width="2"></a-text>
                </a-entity>          
                
                <!-- Cursor for clicking with mouse or touch --
                <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable; showLine: true;" position="0 0 0"></a-entity> -->
            </a-entity>
            
            
            <!-- Environment -->
            <a-entity environment="preset: forest; dressingAmount: 500"></a-entity>
        </a-scene>
    </body>
</html>
